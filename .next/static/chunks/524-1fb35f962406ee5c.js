"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{1524:(e,t,n)=>{n.d(t,{default:()=>u});var l=n(5155),o=n(2115),i=n(4239),a=n(7472);function r(){let[e,t]=(0,o.useState)([]),[n,i]=(0,o.useState)(null),[r,s]=(0,o.useState)(""),[u,d]=(0,o.useState)({});(0,o.useEffect)(()=>{fetch("/api/floorplans").then(e=>e.json()).then(e=>{let t={};e.floorplans&&e.floorplans.forEach(e=>{e.building&&"UNKNOWN"!==e.building&&(t[e.building]||(t[e.building]=[]),t[e.building].push({filename:e.filename,floor:e.floor}))}),d(t)})},[]);let c=(0,o.useRef)(null),p=(0,o.useRef)(null);function h(e){if(null===c.current||null===p.current)return;let n=document.getElementById("dot-map-container");if(!n)return;let l=n.getBoundingClientRect(),o=(e.clientX-l.left)/l.width-p.current.x,i=(e.clientY-l.top)/l.height-p.current.y;t(e=>e.map((e,t)=>t===c.current?{...e,x:Math.max(0,Math.min(1,o)),y:Math.max(0,Math.min(1,i))}:e))}function g(){c.current=null,p.current=null,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",g)}return(0,l.jsxs)("div",{style:{width:"100vw",height:"100vh",background:"#f8f8f8"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",margin:8},children:[(0,l.jsx)("h2",{style:{margin:0,marginRight:16},children:"Manual Building Dot Placer"}),(0,l.jsx)("button",{onClick:function(){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),l=document.createElement("a");l.href=n,l.download="manual_building_lookup.json",l.click(),URL.revokeObjectURL(n)},style:{fontSize:16,padding:"8px 16px"},children:"Export JSON"}),(0,l.jsxs)("span",{style:{marginLeft:16,color:"#888"},children:["Dots placed: ",e.length]})]}),(0,l.jsx)("div",{id:"dot-map-container",style:{position:"relative",width:"80vw",height:"80vh",margin:"auto"},children:(0,l.jsx)(a.GT,{children:(0,l.jsx)(a.WZ,{children:(0,l.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},onContextMenu:function(e){e.preventDefault();let t=e.currentTarget.querySelector("img");if(!t)return;let n=t.getBoundingClientRect(),l=(e.clientX-n.left)/n.width,o=(e.clientY-n.top)/n.height;l>=0&&l<=1&&o>=0&&o<=1&&(i({x:l,y:o}),s(""))},children:[(0,l.jsx)("img",{src:"/uw campus map.png",alt:"Campus Map",style:{width:"100%",height:"100%",objectFit:"contain",display:"block"}}),e.map((n,i)=>{let[a,r]=(0,o.useState)(!1);return(0,l.jsxs)("div",{style:{position:"absolute",top:"".concat(100*n.y,"%"),left:"".concat(100*n.x,"%"),width:21,height:21,borderRadius:"50%",background:"yellow",border:"2px solid #888",display:"flex",alignItems:"center",justifyContent:"center",transform:"translate(-50%, -50%)",zIndex:10,fontWeight:"bold",color:"#222",fontSize:12,cursor:"grab",userSelect:"none"},title:n.building,onMouseDown:t=>(function(t,n){t.stopPropagation(),c.current=n;let l=t.currentTarget.parentElement.getBoundingClientRect(),o=(t.clientX-l.left)/l.width,i=(t.clientY-l.top)/l.height;p.current={x:o-e[n].x,y:i-e[n].y},document.addEventListener("mousemove",h),document.addEventListener("mouseup",g)})(t,i),onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[n.building,(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),t(e=>e.filter((e,t)=>t!==i))},style:{position:"absolute",top:-10,right:-10,width:18,height:18,borderRadius:"50%",background:"#f44",color:"#fff",border:"none",fontSize:12,cursor:"pointer",zIndex:20},title:"Delete dot",children:"\xd7"}),a&&u[n.building]&&(0,l.jsx)("div",{style:{position:"absolute",top:"50%",left:"110%",transform:"translateY(-50%)",background:"#fff",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"6px 12px",minWidth:"60px",zIndex:30,pointerEvents:"auto",whiteSpace:"nowrap"},children:u[n.building].map(e=>(0,l.jsx)("button",{style:{display:"block",width:"100%",margin:"2px 0",padding:"4px 8px",fontSize:"12px",background:"#eee",border:"1px solid #bbb",borderRadius:"4px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/clean_floorplans/".concat(e.filename),"_blank"),children:e.floor.replace("FLR","")},e.filename))})]},i)}),n&&(0,l.jsxs)("div",{style:{position:"absolute",top:"".concat(100*n.y,"%"),left:"".concat(100*n.x,"%"),transform:"translate(-50%, -120%)",zIndex:20,background:"#fff",border:"1px solid #ccc",borderRadius:8,padding:12,boxShadow:"0 2px 8px rgba(0,0,0,0.15)",minWidth:120},children:[(0,l.jsxs)("div",{style:{marginBottom:8},children:[(0,l.jsx)("label",{children:"Building Code: "}),(0,l.jsx)("input",{type:"text",value:r,onChange:e=>s(e.target.value),style:{width:60,fontWeight:"bold"},autoFocus:!0})]}),(0,l.jsx)("button",{onClick:function(){r.trim()&&n&&(t([...e,{x:n.x,y:n.y,building:r.trim()}]),i(null),s(""))},style:{marginRight:8},children:"Save"}),(0,l.jsx)("button",{onClick:()=>i(null),children:"Cancel"})]})]})})})})]})}var s=n(9509);function u(){let[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(""),u="qwertyuiop",[d,c]=(0,o.useState)(""),p="";p=s.env.NEXT_PUBLIC_PASSCODE,(0,o.useEffect)(()=>{let e=e=>{c(n=>{let l=(n+e.key).slice(-u.length);return l===u&&t(!0),l})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let[h,g]=(0,o.useState)(null),[x,f]=(0,o.useState)(null),[m,b]=(0,o.useState)(null),[y,v]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[C,S]=(0,o.useState)(null),[R,k]=(0,o.useState)(null),[N,E]=(0,o.useState)(null);(0,o.useEffect)(()=>{if(C){E(C);let e=setTimeout(()=>E(null),2500);return()=>clearTimeout(e)}if(R){E(R);let e=setTimeout(()=>E(null),2500);return()=>clearTimeout(e)}},[C,R]);let[L,M]=(0,o.useState)(""),[T,P]=(0,o.useState)(""),[W,z]=(0,o.useState)(""),[I,U]=(0,o.useState)(""),B=async l=>{if(l.preventDefault(),!h||null==m||null==y||!T)return void k("Please fill all fields, select an image, and location on the map.");j(!0),k(null),S(null);try{let l=new FormData;l.append("image",h),l.append("xCoordinate",String(m)),l.append("yCoordinate",String(y)),l.append("name",L),l.append("building",T),l.append("latitude",W),l.append("longitude",I);let o="needs approval",i=!1;e&&n===p&&(o="approved",i=!0),l.append("status",o),(await fetch("api/uploadLocation",{method:"POST",body:l})).ok?(S("Location uploaded successfully!"),i&&(E("Welcome devs!"),setTimeout(()=>E(null),2500)),g(null),f(null),b(null),v(null),M(""),P(""),z(""),U(""),a(""),t(!1)):k("Upload failed.")}catch(e){k("Error uploading location.")}j(!1)};return(0,l.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:[e&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 flex flex-col items-center",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Enter Passcode"}),(0,l.jsx)("input",{type:"password",value:n,onChange:e=>a(e.target.value),className:"border rounded px-4 py-2 mb-4 text-lg",autoFocus:!0}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded shadow hover:bg-blue-700",onClick:()=>t(!1),children:"Close"}),(0,l.jsx)("button",{className:"px-4 py-2 bg-green-600 text-white rounded shadow hover:bg-green-700",onClick:()=>{n===p?(E("Welcome devs!"),setTimeout(()=>E(null),2500),t(!1)):(E("Incorrect passcode"),setTimeout(()=>E(null),2500))},children:"Submit"})]})]})}),(0,l.jsxs)("form",{className:"w-full max-w-lg bg-white rounded-lg shadow-md p-6 flex flex-col gap-4",onSubmit:B,children:[N&&(0,l.jsx)("div",{className:"fixed top-6 right-6 z-50 px-6 py-3 rounded-lg shadow font-bold text-white ".concat(N===C?"bg-green-600":"bg-red-600"),children:N}),(0,l.jsx)("h2",{className:"text-2xl font-bold mb-2 text-gray-800",children:"Upload Campus Location"}),(0,l.jsx)("label",{className:"block font-medium text-gray-700",children:"Image File"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let n=(null==(t=e.target.files)?void 0:t[0])||null;g(n),S(null),k(null),n?f(URL.createObjectURL(n)):f(null)},className:"mb-2"}),(0,l.jsx)("label",{className:"block font-medium text-gray-700",children:"Building"}),(0,l.jsx)("input",{type:"text",value:T,onChange:e=>P(e.target.value),required:!0,className:"border rounded px-3 py-2 mb-2"}),x&&(0,l.jsx)("img",{src:x,alt:"Preview",className:"max-w-xs rounded shadow mb-2"}),(0,l.jsx)("div",{className:"flex items-center justify-center w-full",style:{width:"100%",margin:0,padding:0},children:(0,l.jsx)("div",{style:{width:"90vw",maxWidth:1200,aspectRatio:"896/683",position:"relative",background:"#eaeaea",borderRadius:12,overflow:"hidden",margin:0,padding:0},children:(0,l.jsx)(i.A,{xCoor:m,yCoor:y,setXCoor:b,setYCoor:v,xRightCoor:null,yRightCoor:null,aspectRatio:.25})})}),(0,l.jsx)("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded shadow hover:bg-blue-700 disabled:opacity-50",children:w?"Uploading...":"Submit Location"}),C&&(0,l.jsx)("div",{className:"text-green-600 font-semibold",children:C}),R&&(0,l.jsx)("div",{className:"text-red-600 font-semibold",children:R})]}),n===p&&!e&&(0,l.jsx)("div",{style:{width:"100%",maxWidth:1e3,margin:"32px auto 0 auto"},children:(0,l.jsx)(r,{})})]})}},4239:(e,t,n)=>{n.d(t,{A:()=>a});var l=n(5155),o=n(2115),i=n(7472);function a(e){let[t,n]=(0,o.useState)([]),[a,r]=(0,o.useState)([]),s=(0,o.useRef)(null),[u,d]=(0,o.useState)(null),c=(0,o.useRef)(0),p=(0,o.useRef)(0),h=(0,o.useRef)(1),[g,x]=(0,o.useState)(null);return(0,o.useRef)(null),(0,o.useEffect)(()=>{fetch("/api/floorplans").then(e=>e.json()).then(e=>{n(e.floorplans||[]),r(e.buildings||[])})},[]),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"w-full h-full bg-gray-50",style:{position:"relative"},children:(0,l.jsx)(i.GT,{onPanningStop:function(e,t){c.current=-e.state.positionX,p.current=-e.state.positionY,h.current=e.state.scale},onZoomStop:function(e,t){c.current=-e.state.positionX,p.current=-e.state.positionY,h.current=e.state.scale},children:(0,l.jsx)(i.WZ,{children:(0,l.jsxs)("div",{onClick:function(t){if(e.disabled)return;let n=t.currentTarget,l=t.nativeEvent.offsetX/n.clientWidth,o=t.nativeEvent.offsetY/n.clientHeight;e.setXCoor(l),e.setYCoor(o)},className:"w-full h-full cursor-crosshair relative",children:[(0,l.jsx)("img",{ref:s,className:"MapPicture w-full h-full select-none",src:"/uw campus map.png",alt:"Campus Map",draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block",pointerEvents:"auto"}}),null!=e.xCoor&&null!=e.yCoor&&null!=e.xRightCoor&&null!=e.yRightCoor&&(0,l.jsx)("div",{style:(()=>{if(null!=e.xCoor&&null!=e.yCoor&&null!=e.xRightCoor&&null!=e.yRightCoor){let t=document.querySelector(".MapPicture");if(!t)return{};let n=t.clientWidth,l=t.clientHeight,o=e.xCoor*n,i=e.yCoor*l,a=e.xRightCoor*n,r=e.yRightCoor*l,s=Math.sqrt(Math.pow(a-o,2)+Math.pow(r-i,2)),u=180/Math.PI*Math.atan2(r-i,a-o);return{position:"absolute",top:"".concat(i,"px"),left:"".concat(o,"px"),width:"".concat(s,"px"),transform:"rotate(".concat(u,"deg) translate(0, -50%)"),transformOrigin:"0 0",height:"1.5px",backgroundColor:"black"}}return{}})()}),null!=e.xCoor&&null!=e.yCoor&&(0,l.jsx)("div",{style:{top:"".concat(100*e.yCoor,"%"),left:"".concat(100*e.xCoor,"%"),position:"absolute",width:"3px",height:"3px",borderRadius:"50%",backgroundColor:"red",pointerEvents:"none",transform:"translate(-50%, -50%)"},className:"z-10"}),null!=e.xRightCoor&&null!=e.yRightCoor&&(0,l.jsx)("div",{style:{top:"".concat(100*e.yRightCoor,"%"),left:"".concat(100*e.xRightCoor,"%"),position:"absolute",width:"3px",height:"3px",borderRadius:"50%",backgroundColor:"limegreen",pointerEvents:"none",transform:"translate(-50%, -50%)"},className:"z-10"}),e.children]})})})})})}}}]);